<?php
// content_generator.php - コンテンツ生成API
require_once 'config.php';

// レスポンスのContent-Typeをapplication/jsonに設定
header('Content-Type: application/json');

// POSTリクエストからJSONデータを取得
$json_data = file_get_contents('php://input');
$request_data = json_decode($json_data, true);

// データが正しく取得できなかった場合のエラー処理
if (!$request_data || !isset($request_data['newsData']) || !isset($request_data['format'])) {
    http_response_code(400);
    echo json_encode([
        'error' => '不正なリクエストデータです'
    ]);
    exit;
}

// リクエストからデータを取得
$news_data = $request_data['newsData'];
$format = $request_data['format'];
$news_content = isset($news_data['answer']) ? $news_data['answer'] : '';
$keywords = isset($news_data['keywords']) ? $news_data['keywords'] : [];

// キーワードがない場合はデフォルト値を設定
if (empty($keywords) || !is_array($keywords)) {
    $keywords = ['AI', '生成AI'];
}

// キーワードを文字列に変換
$keywords_str = implode(', ', $keywords);

// 現在の日時を取得
$current_datetime = date('Y年m月d日 H:i:s');

// フォーマットに応じてプロンプトを構築
switch ($format) {
    case 'blog':
        $prompt = "以下のAIニュース要約をもとに、読者にとって有益な1500文字程度のブログ記事を作成してください。
タイトル、導入部、主要ポイント、分析、結論を含めてください。
また、タイトルはH1タグ、見出しはH2タグで囲んでください。

【キーワード】: {$keywords_str}
【ニュース要約】:
{$news_content}";
        break;

    case 'newsletter':
        $prompt = "以下のAIニュース要約をもとに、配信可能なニュースレターを作成してください。
挨拶文、ニュースのハイライト、詳細リンク、締めの文を含めてください。
800〜1000文字程度にまとめ、読みやすさを重視してください。

【キーワード】: {$keywords_str}
【ニュース要約】:
{$news_content}";
        break;
        
    case 'executive':
        $prompt = "以下のAIニュース要約をもとに、ビジネスリーダー向けのエグゼクティブサマリーを作成してください。
重要なポイントのみを箇条書きで簡潔に記載し、ビジネスへの影響と対応策を含めてください。
500文字以内の簡潔な内容にしてください。

【キーワード】: {$keywords_str}
【ニュース要約】:
{$news_content}";
        break;

    case 'socialmedia':
        $prompt = "以下のAIニュース要約をもとに、Twitter/X、LinkedIn、Facebookで共有できる3種類のSNS投稿文を作成してください。
各プラットフォームの特性に合わせ、適切なハッシュタグと絵文字を含めてください。
Twitterは280文字以内、LinkedInとFacebookは適切な長さで作成してください。

【キーワード】: {$keywords_str}
【ニュース要約】:
{$news_content}";
        break;

    case 'technical':
        $prompt = "以下のAIニュース要約をもとに、技術者向けの詳細な技術レポートを作成してください。
技術的背景、実装の詳細、関連する技術スタック、応用例、今後の展望を含めてください。
専門用語を適切に使用し、2000文字程度の内容にしてください。

【キーワード】: {$keywords_str}
【ニュース要約】:
{$news_content}";
        break;

    default:
        $prompt = "以下のAIニュース要約をもとに、読みやすいブログ記事を作成してください。
タイトル、導入部、主要ポイント、結論を含めてください。

【キーワード】: {$keywords_str}
【ニュース要約】:
{$news_content}";
        break;
}

// API キーは config.php で定義されている定数から取得
$api_key = OPENAI_API_KEY;

// 変数の初期化
$content = "";
$raw_response = "";

// テストモードまたはAPI呼び出し
if (TEST_MODE) {
    // テストモードではダミーデータを生成
    $test_contents = [
        'blog' => "<h1>2025年のAI最前線：5つの重要なブレイクスルー</h1>

<p>AIの世界は日進月歩で進化し続けています。{$current_datetime}時点での最新動向を追ってみましょう。</p>

<h2>1. NECの業務自動化エージェント</h2>

<p>NECが発表した専門業務自動化AIエージェントは、企業の業務効率を根本から変えようとしています。cotomiという独自開発の生成AIを活用したこのシステムは、経営計画から人材管理まで幅広い分野での利用が期待されています。</p>

<p>特筆すべきは、業務要求の理解から実行までを一貫して自動化できる点です。これまでのAIツールは単発のタスクに対応するものが多かったですが、一連のワークフローを自律的に処理できるという点で画期的と言えるでしょう。</p>

<h2>2. Googleの推論型AI「Gemini 2.0 Flash Thinking」</h2>

<p>OpenAIのo1モデルに対抗する形で登場したGoogleの新モデルは、複雑な推論能力において新たな基準を打ち立てています。数学や物理学の問題解決に特化したこのモデルは、人間のような思考プロセスをシミュレートし、段階的に問題を分解して解決するアプローチを取っています。</p>

<p>マルチモーダルな理解能力も向上しており、テキスト、画像、音声を組み合わせたより自然なインタラクションが可能になっています。</p>

<h2>3. AIエージェントツール「Google Agentspace」</h2>

<p>Google Cloudが発表した「Google Agentspace」は、企業内で個人レベルで生成AIを活用できる環境を提供します。NotebookLMの拡張版として位置づけられるこのツールは、社内情報を効果的に活用したコンテンツ生成や調査を支援します。</p>

<p>特に注目すべきは、非エンジニアでも直感的に使える設計になっている点です。AIの民主化という観点から、今後の企業内AIツール導入の一つのモデルケースとなるでしょう。</p>

<h2>4. 進化するAppleのSiri</h2>

<p>長らく大きな変化がなかったAppleのSiriも、機械学習とAIの進歩により大幅な進化を遂げつつあります。文脈理解の精度向上や、より自然な会話が可能になったことで、ユーザー体験は格段に向上しています。</p>

<p>特に注目すべきは拡張現実（AR）技術との統合の可能性です。Apple Vision Proの登場と合わせて、空間コンピューティングの時代におけるAIアシスタントの新たな形を示唆しています。</p>

<h2>5. AIインフラの進化</h2>

<p>ニデックのAIサーバ向け水冷装置が5,000台の出荷を突破したニュースは、AIインフラの急速な拡大を物語っています。生成AIの普及に伴い、高性能コンピューティング需要が急増する中、冷却技術の重要性も高まっています。</p>

<p>こうしたインフラ面の進化があってこそ、私たちが日常的に使うAIサービスの品質向上が実現しているのです。</p>

<p>以上のトレンドが示すように、AIは単なるツールから、業務プロセス全体を変革する存在へと進化しています。企業はこれらの動向を注視し、自社のデジタルトランスフォーメーション戦略に積極的に取り入れていくことが重要でしょう。</p>",

        'newsletter' => "# AI Weekly Update - {$current_datetime}

親愛なる購読者の皆様

今週も最新のAI動向をお届けします。今週は特に企業向けAIソリューションの進展が目立ちました。

## 今週のハイライト

**🔹 NECが業務自動化AIエージェントを発表**
NEC独自開発の生成AI「cotomi」を活用した新サービスが登場。経営計画から人材管理まで、専門業務の自動化が可能に。業務効率化を検討している企業は要チェックです。

**🔹 GoogleがGemini 2.0 Flash Thinkingを公開**
複雑な推論能力に特化した新モデルがOpenAIのo1モデルへの対抗馬として登場。数学や科学の問題解決能力が大幅に向上しています。

**🔹 企業向けAIワークスペース「Google Agentspace」**
Google Cloudが発表した新ツールは、社内情報を活用したコンテンツ生成や調査を効率化。非エンジニアでも使いやすい設計が特徴です。

**🔹 Siriの進化とAR統合の展望**
Appleの音声アシスタントが文脈理解能力を向上。将来的にはAR技術との統合も見込まれています。

## 業界動向

生成AIの需要増加に伴い、ニデックのAIサーバ向け水冷装置の出荷台数が5,000台を突破。AIインフラ市場の急速な拡大を示しています。

また、Adobe Expressなどの生成AI活用コンテンツ制作ツールの導入も進み、電通などの企業ではコンテンツ制作時間の70%削減に成功した事例も報告されています。

## 次回予告

次回は、これらの技術を活用した実際の導入事例と、中小企業でも取り入れられるAI活用法についてご紹介します。

ご質問やリクエストがありましたら、このメールに返信いただくか、当社ウェブサイトのお問い合わせフォームからご連絡ください。

AIの最新動向にご興味をお持ちいただき、ありがとうございます。

AI Weekly編集部",

        'executive' => "# AIトレンド エグゼクティブサマリー ({$current_datetime})

## 重要ポイント

• **業務自動化**: NECが専門業務自動化AIエージェント「cotomi」を発表。経営計画から人材管理まで一貫して自動化可能。
→ **対応策**: 自社の業務プロセスを見直し、自動化可能な領域の特定を急ぐべき。

• **推論AI**: GoogleがOpenAIに対抗する「Gemini 2.0 Flash Thinking」を発表。複雑な問題解決能力に特化。
→ **対応策**: 研究開発やデータ分析チームへの導入検討を開始。

• **企業内AI活用**: Google Cloudが「Agentspace」を発表。社内情報を活用した生成AIプラットフォーム。
→ **対応策**: 部門横断チームで試験導入し、ナレッジマネジメント強化への活用を検討。

• **インフラ需要急増**: AIサーバ向け冷却液分配装置の出荷が5,000台突破。生成AI普及に伴うインフラ投資拡大。
→ **対応策**: 自社DXプランのインフラ予算見直しと長期投資計画の策定。

• **コンテンツ制作革新**: Adobe Express等の生成AIツールで制作時間70%削減の事例。
→ **対応策**: マーケティング部門への導入を促進し、コンテンツ制作効率化を図る。

## 市場インパクト

• 専門業務の自動化により、知識労働者の役割が変化し、戦略的思考へのシフトが加速
• AIインフラ需要の高まりによる半導体・冷却技術関連企業の成長機会拡大
• 企業内AIツール普及による組織知の活用度向上とイノベーション加速

## 直近アクション項目

1. 各部門のAI活用度合いを評価する社内監査の実施（2週間以内）
2. 専門業務自動化の導入ロードマップ策定（1ヶ月以内）
3. 社内データ活用戦略の見直しと必要インフラの検討（四半期内）",

        'socialmedia' => "## Twitter/X投稿

📱 最新AI動向まとめ！NECが業務自動化AIエージェント発表、GoogleはOpenAIに対抗する「Gemini 2.0 Flash Thinking」公開、企業向け「Agentspace」も登場。Siriも進化中、AIインフラ需要も急増！ #AI #AIニュース #テクノロジー #生成AI

## LinkedIn投稿

🔍 【AI業界最新動向レポート - {$current_datetime}】

先週のAI業界の重要な動きをお届けします：

1️⃣ NECが専門業務自動化の次世代AIエージェント「cotomi」を発表。経営計画から人材管理まで一貫して自動化可能に。

2️⃣ GoogleがOpenAIのo1モデルに対抗する「Gemini 2.0 Flash Thinking」を公開。マルチモーダル理解と複雑な推論能力に優れたモデルで、特に数学や物理学などの問題解決に強み。

3️⃣ Google CloudがAIエージェントツール「Google Agentspace」を発表。社内情報を活用してプランニングや調査、コンテンツ生成などを効率化。

4️⃣ AppleのSiriが進化中。文脈理解の改善や自然な応答が可能に。将来的にはAR技術との統合も期待。

5️⃣ AIインフラ需要急増中。ニデックのAIサーバ向け水冷装置が5,000台出荷を達成。

これらのトレンドは、私たちのビジネスプロセスやデジタル戦略にどのような影響を与えるでしょうか？ご意見をコメントでお聞かせください。

#AIトレンド #デジタルトランスフォーメーション #生成AI #ビジネステクノロジー #企業DX

## Facebook投稿

🤖 【AI最新ニュース - 今週のハイライト】

AIの世界は驚くべきスピードで進化しています！今週は特に企業向けソリューションが充実。

◆ NECが業務自動化AIエージェント「cotomi」を発表
◆ GoogleがOpenAIに対抗する高度な推論モデル「Gemini 2.0 Flash Thinking」を公開
◆ Google CloudがAIエージェントツール「Google Agentspace」をリリース
◆ AppleのSiriが進化、将来的にAR技術との統合も視野に
◆ AIインフラ需要が急増、冷却技術の重要性も高まる

これらの技術はビジネスだけでなく、私たちの日常生活も変える可能性を秘めています。皆さんは最近、どんなAIツールを使っていますか？

#AI革命 #テクノロジー最前線 #デジタル化 #未来技術",

        'technical' => "# AI技術動向詳細レポート: {$current_datetime}

## 1. NECによる業務自動化AIエージェントの技術的考察

NECが発表した新しいAIエージェントサービスは、同社独自開発の生成AI「cotomi」をバックエンドに採用している。このモデルは公開されている詳細が限られているが、大規模言語モデル（LLM）をベースに企業特有のドメイン知識を事前学習させ、ファインチューニングを行ったと推測される。

注目すべき技術的特徴は以下の通り：
- 業務要求の自然言語理解から実行までの一貫したパイプライン構築
- 企業固有のデータセキュリティを考慮した推論インフラ
- APIエコシステムを介した既存業務システムとの統合

実装上の課題として、専門業務特有の用語理解と文脈把握の精度向上、対話履歴からの要求意図の正確な抽出などが挙げられる。これらはコンテキストウィンドウの拡大とドメイン特化型事前学習によって解決を図っていると考えられる。

## 2. Gemini 2.0 Flash Thinkingのアーキテクチャ分析

GoogleのGemini 2.0 Flash Thinkingは、推論型AIモデルとして以下の技術的進化を遂げている：

- **アーキテクチャ**: Transformer-basedだが、従来のLLMに「思考ツリー」構造を組み込み、複数の推論パスを並列に評価可能
- **パラメータ効率**: モデルサイズは非公開だが、推論性能とパラメータ効率のトレードオフを最適化したスパースアクティベーション手法を採用
- **マルチモーダル処理**: 画像、テキスト、数式を統合的に処理するエンコーダ設計

特筆すべきは、数学や物理学の問題解決における「思考の外在化」手法。従来のCoTプロンプティングを超え、モデル内部で複数の解法を自動生成し、最適解を選択するメタ認知的アプローチを実装している点が革新的である。

## 3. Google Agentspaceの技術スタック

Google Cloudの「Google Agentspace」は、NotebookLMをベースに以下の技術スタックで構築されている：

```
Frontend: React + TypeScript
Backend: Kubernetes上のマイクロサービスアーキテクチャ
データ処理: Apache Beam + BigQuery
LLM: Gemini API
RAG: BERT-basedエンベディングモデル + ベクトルデータベース
```

企業内情報の活用に際して、ドキュメント解析パイプラインが重要な役割を果たす。PDFやWord、スプレッドシート、画像内テキストなど多様なフォーマットから情報を抽出・構造化し、効率的なベクトル表現に変換するプロセスが実装されている。

セキュリティ面では、ゼロトラストセキュリティモデルに基づいたアクセス制御、データの漏洩防止メカニズム、プロンプトインジェクション対策などが導入されている。

## 4. Siriの技術的進化とARの統合可能性

Appleの音声アシスタントSiriの進化は、以下の技術的側面から分析できる：

- **オンデバイス処理**: Apple Silicon搭載デバイスの計算能力向上により、プライバシー重視のオンデバイスNLPが強化
- **コンテキスト管理**: 長期的な会話履歴と短期的なユーザーインテント推定を組み合わせた階層的コンテキストモデル
- **マルチモーダル対応**: 音声認識と画像理解を統合したマルチモーダルAI処理能力

AR技術との統合は、Apple Vision Proを中心としたエコシステムの一部として計画されている。空間計算とAIアシスタントの融合により、実世界とデジタル情報の自然なブレンドが実現される見込みだ。技術的課題としては、空間認識精度、ジェスチャー認識、低レイテンシー応答の実現などが挙げられる。

## 5. AIインフラストラクチャの技術動向

ニデックのAIサーバ向け冷却液分配装置（CDU）の需要急増は、AI計算インフラの技術的進化を反映している：

- **熱密度**: 最新GPUクラスタは1ラックあたり最大100kWの熱密度に達し、従来の空冷方式では対応不能
- **冷却効率**: 水冷方式は空冷と比較して約1,500倍の熱伝導効率を実現
- **システム設計**: 2相冷却(二層)技術により、熱伝達効率のさらなる向上が実現

これらのインフラ技術の進化なくして、大規模生成AIモデルのトレーニングと推論は実現不可能である。特に注目すべきは、環境負荷低減を考慮した冷却システム設計と、データセンター全体のエネルギー効率最適化手法だ。

## 結論と今後の展望

これらの技術トレンドから、AIの進化は「モデル自体の能力向上」と「実用的なシステム統合」の二軸で進行していることが分かる。今後は特に以下の点に注目が集まるだろう：

1. 専門分野での深い文脈理解と推論能力を備えたドメイン特化型AIの台頭
2. エンタープライズシステムとAIの統合による業務プロセスの自動化推進
3. エッジデバイスとクラウドAIの効果的な統合によるユビキタスAIエクスペリエンスの実現
4. AI計算効率の向上と環境負荷低減を両立する新世代コンピューティングインフラの開発

これらの技術革新は単に効率化をもたらすだけでなく、人間とAIの協働モデルを根本から再定義する可能性を秘めている。"
    ];

    // フォーマットに応じたテスト用コンテンツを返す
    $content = isset($test_contents[$format]) ? $test_contents[$format] : $test_contents['blog'];
    
    // テスト用レスポンスを構築
    $response = [
        'content' => $content,
        'format' => $format,
        'timestamp' => date('Y年m月d日 H:i:s')
    ];
    
    echo json_encode($response);
    exit;
}

// API エンドポイント
$url = "https://api.openai.com/v1/chat/completions";

// リクエストデータ
$data = array(
    "model" => defined('MODEL_NAME') ? MODEL_NAME : "gpt-4o",
    "messages" => array(
        array(
            "role" => "system",
            "content" => "あなたはプロのコンテンツクリエーターです。ユーザーが提供するニュース要約をもとに、指定された形式で高品質なコンテンツを生成します。"
        ),
        array(
            "role" => "user",
            "content" => $prompt
        )
    ),
    "temperature" => 0.7,
    "max_tokens" => 3000
);

// HTTP ヘッダー設定
$headers = array(
    "Content-Type: application/json",
    "Authorization: Bearer " . $api_key
);

// cURL で POST リクエストを実行
$ch = curl_init($url);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$response = curl_exec($ch);
curl_close($ch);

// APIレスポンスを処理
$result = json_decode($response, true);

// 結果の抽出
if (isset($result['choices']) && isset($result['choices'][0]['message']['content'])) {
    $content = $result['choices'][0]['message']['content'];
} else {
    $content = "コンテンツの生成中にエラーが発生しました。";
}

// 結果をJSONで返す
echo json_encode([
    'content' => $content,
    'format' => $format,
    'timestamp' => date('Y年m月d日 H:i:s')
]);
